"use strict";(self.webpackChunkflasher=self.webpackChunkflasher||[]).push([[179],{7973:(e,t,n)=>{function a({type:e,title:t,message:n,buttonText:a="OK",confirmText:r="OK",cancelText:s="Cancel",closeStyle:o}){return new Promise((i=>{setInterval((()=>{}),5e3);const l=document.querySelector("body");let c="alert-close";"circle"===o&&(c="alert-close-circle");let d=`<button class="alert-button ${e}-bg ${e}-btn mui-btn mui-btn--primary">${a}</button>`;"question"===e&&(d=`\n<div class="question-buttons">\n  <button class="confirm-button error-bg error-btn mui-btn mui-btn--danger">${r}</button>\n  <button class="cancel-button question-bg question-btn mui-btn">${s}</button>\n</div>\n`);let u='\n<svg class="alert-img" xmlns="http://www.w3.org/2000/svg" fill="#fff" viewBox="0 0 52 52" xmlns:v="https://vecta.io/nano">\n<path d="M26 0C11.664 0 0 11.663 0 26s11.664 26 26 26 26-11.663 26-26S40.336 0 26 0zm0 50C12.767 50 2 39.233 2 26S12.767 2 26 2s24 10.767 24 24-10.767 24-24\n24zm9.707-33.707a1 1 0 0 0-1.414 0L26 24.586l-8.293-8.293a1 1 0 0 0-1.414 1.414L24.586 26l-8.293 8.293a1 1 0 0 0 0 1.414c.195.195.451.293.707.293s.512-.098.707\n-.293L26 27.414l8.293 8.293c.195.195.451.293.707.293s.512-.098.707-.293a1 1 0 0 0 0-1.414L27.414 26l8.293-8.293a1 1 0 0 0 0-1.414z"/>\n</svg>\n';"success"===e&&(u='\n<svg class="alert-img" xmlns="http://www.w3.org/2000/svg" fill="#fff" viewBox="0 0 52 52" xmlns:v="https://vecta.io/nano">\n<path d="M26 0C11.664 0 0 11.663 0 26s11.664 26 26 26 26-11.663 26-26S40.336 0 26 0zm0 50C12.767 50 2 39.233 2 26S12.767 2 26 2s24 10.767 24 24-10.767 24-24\n24zm12.252-34.664l-15.369 17.29-9.259-7.407a1 1 0 0 0-1.249 1.562l10 8a1 1 0 0 0 1.373-.117l16-18a1 1 0 1 0-1.496-1.328z"/>\n</svg>\n'),"info"===e&&(u='\n<svg class="alert-img" xmlns="http://www.w3.org/2000/svg" fill="#fff" viewBox="0 0 64 64" xmlns:v="https://vecta.io/nano">\n<path d="M38.535 47.606h-4.08V28.447a1 1 0 0 0-1-1h-4.52a1 1 0 1 0 0 2h3.52v18.159h-5.122a1 1 0 1 0 0 2h11.202a1 1 0 1 0 0-2z"/>\n<circle cx="32" cy="18" r="3"/><path d="M32 0C14.327 0 0 14.327 0 32s14.327 32 32 32 32-14.327 32-32S49.673 0 32 0zm0 62C15.458 62 2 48.542 2 32S15.458 2 32 2s30 13.458 30 30-13.458 30-30 30z"/>\n</svg>\n');const p=`\n<div class="alert-wrapper">\n  <div class="alert-frame">\n    <div class="alert-header ${e}-bg">\n      <span class="${c}">X</span>\n      ${u}\n    </div>\n    <div class="alert-body">\n      <span class="alert-title">${t}</span>\n      <span class="alert-message">${n.replace("\n","<br/>")}</span>\n      ${d}\n    </div>\n  </div>\n</div>\n`;l.insertAdjacentHTML("afterend",p);const h=document.querySelector(".alert-wrapper"),f=document.querySelector(".alert-frame"),m=document.querySelector(`.${c}`);function v(){h.remove(),i()}if("question"===e){const e=document.querySelector(".confirm-button"),t=document.querySelector(".cancel-button");e.addEventListener("click",(function(){h.remove(),i("confirm")})),t.addEventListener("click",v)}else{document.querySelector(".alert-button").addEventListener("click",v)}m.addEventListener("click",v),h.addEventListener("click",v),f.addEventListener("click",(function(e){e.stopPropagation()}))}))}n.d(t,{Q:()=>a})},7788:(e,t,n)=>{n(1385);const a=function(){const e=[];let t=0;for(;t<64;)e[t]=0|4294967296*Math.abs(Math.sin(++t));return function(t){let n,a,r,s;const o=[],i=unescape(encodeURI(t));let l=i.length;const c=[n=1732584193,a=-271733879,~n,~a];let d=0;for(;d<=l;)o[d>>2]|=(i.charCodeAt(d)||128)<<d++%4*8;for(o[t=16*(l+8>>6)+14]=8*l,d=0;d<t;d+=16){for(l=c,s=0;s<64;)l=[r=l[3],(n=0|l[1])+((r=l[0]+[n&(a=l[2])|~n&r,r&n|~r&a,n^a^r,a^(n|~r)][l=s>>4]+(e[s]+(0|o[[s,5*s+1,3*s+5,7*s][l]%16+d])))<<(l=[7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][4*l+s++%4])|r>>>32-l),n,a];for(s=4;s;)c[--s]=c[s]+l[s]}for(t=[];s<32;)t.push(16*(c[s>>3]>>4*(1^7&s++)&15)+(c[s>>3]>>4*(1^7&s++)&15));return new Uint8Array(t)}}();function r(){const e=document.getElementById("uid");function t(t){if(""===t)e.value="";else{const n=function(e){return a(`-DMY_BINDING_PHRASE="${e}"`).subarray(0,6)}(t);e.value=n}}document.getElementById("phrase").addEventListener("input",(function(e){t(e.target.value)})),t("")}class s{static#e=new Uint8Array([190,239,186,190,202,254,240,13]);static#t(e){return e.findIndex(((e,t,n)=>{let a=0;for(;a<s.#e.length&&n[t+a]===s.#e[a];)a++;return a===s.#e.length}))}static#n(e,t,n){return void 0!==n&&(e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255),t+4}static#a(e,t,n){e[t]=n.beeptype,t+=1;for(let n=0;n<128;n++)e[t+n]=0;const a=n.melody;if(a)for(let n=0;n<a.length;n++)e[t+4*n+0]=255&a[n][0],e[t+4*n+1]=a[n][0]>>8&255,e[t+4*n+2]=255&a[n][1],e[t+4*n+3]=a[n][1]>>8&255;return t+=128}static#r(e,t,n){t=this.#n(e,t,n["tlm-report"]);let a=e[t=this.#n(e,t,n["fan-runtime"])];return void 0!==n["uart-inverted"]&&(a&=-2,a|=n["uart-inverted"]?1:0),void 0!==n["unlock-higher-power"]&&(a&=-3,a|=n["unlock-higher-power"]?2:0),e[t]=a,t+1}static#s(e,t,n){let a=e[t=this.#n(e,t,n["rcvr-uart-baud"])];return void 0!==n["rcvr-invert-tx"]&&(a&=-2,a|=n["rcvr-invert-tx"]?1:0),void 0!==n["lock-on-first-connection"]&&(a&=-3,a|=n["lock-on-first-connection"]?2:0),void 0!==n["r9mm-mini-sbus"]&&(a&=-5,a|=n["r9mm-mini-sbus"]?4:0),e[t]=a,t+1}static#o(e,t,n,a){let r=this.#t(e);if(-1===r)throw new Error("Configuration magic not found in firmware file. Is this a 3.x firmware?");r+=8;const s=e[r]+e[r+1]<<8;if(r+=2,0===s&&(r+=1),"sx127x"===n&&a.domain&&(e[r]=a.domain),r+=1,a.uid){e[r]=1;for(let t=0;t<6;t++)e[r+1+t]=a.uid[t]}else e[r]=0;return r+=7,"TX"===t?(r=this.#r(e,r,a),a.beeptype&&(r=this.#a(e,r,a))):"RX"===t&&(r=this.#s(e,r,a)),e}static#i=e=>{if(!e.ok)throw new Error(`HTTP ${e.status} - ${e.statusText}`);return e};static#l=(e,t,n=(e=>e))=>fetch(e).then((e=>this.#i(e).blob())).then((e=>new Promise(((t,n)=>{const a=new FileReader;a.onload=function(){t(new Uint8Array(a.result))},a.readAsArrayBuffer(e)})))).then((e=>({data:n(e),address:t})));static#c=(e,t)=>{let n=0;if("esp8285"===t.platform&&(n=4096),233!==e[n])throw new Error("The file provided does not the right magic for a firmware file!");let a=e[n+1];for(n="esp32"===t.platform?24:4104;a--;){n+=8+(e[n+4]+(e[n+5]<<8)+(e[n+6]<<16)+(e[n+7]<<24))}return n=n+16&-16,"esp32"===t.platform&&(n+=32),n};static#d=(e,t)=>{const n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n};static#u=e=>{const t=e.length;let n="";for(let a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n};static#p=e=>{const t=e.length,n=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=e.charCodeAt(a);return n};static#h=(e,t,n)=>{const a=this.#c(e,t);return e=e.slice(0,a),e=this.#d(e,this.#p(t.product_name.padEnd(128,"\0"))),e=this.#d(e,this.#p(t.lua_name.padEnd(16,"\0"))),e=this.#d(e,this.#p(JSON.stringify(n).padEnd(512,"\0")))};static download=async(e,t,n,a,r)=>{if("stm32"===n.platform){return[(await this.#l(a,0,(n=>this.#o(n,e,t,r)))).data]}{const t=[],o="firmware/"+document.getElementById("version").value;return t.push(this.#l(o+"/hardware/"+e+"/"+n.layout_file,0)),"esp32"===n.platform?(t.push(this.#l(o+"/bootloader_dio_40m.bin",4096)),t.push(this.#l(o+"/partitions.bin",32768)),t.push(this.#l(o+"/boot_app0.bin",57344)),t.push(this.#l(a,65536,(e=>s.#h(e,n,r))))):"esp8285"===n.platform&&t.push(this.#l(a,0,(e=>s.#h(e,n,r)))),await Promise.all(t).then((e=>{n.overlay&&(n.overlay={});const t=this.#p(JSON.stringify({...JSON.parse(this.#u(e[0].data)),...n.overlay}));return e[e.length-1].data=this.#d(e[e.length-1].data,this.#d(t,new Uint8Array([0]))),e.splice(1)}))}}}var o=n(2320),i=n(2617),l=n(7973),c=n(905);function d({title:e,bodyTemplate:t,closeStyle:n}){return new Promise((a=>{setInterval((()=>{}),5e3);const r=document.querySelector("body");let s="alert-close";"circle"===n&&(s="alert-close-circle");const o=`\n<div class="alert-wrapper">\n  <div class="dialog-frame">\n    <div class="dialog-header question-bg">\n      <div class="dialog-title">\n        <span>${e}</span>\n      </div>\n      <span class="${s}">X</span>\n    </div>\n    <div class="alert-body">\n      ${t}\n    </div>\n  </div>\n</div>\n`;r.insertAdjacentHTML("afterend",o);const i=document.querySelector(".alert-wrapper"),l=document.querySelector(".dialog-frame");function c(){i.remove(),a()}document.querySelector(`.${s}`).addEventListener("click",c),i.addEventListener("click",c),l.addEventListener("click",(function(e){e.stopPropagation()})),document.querySelectorAll(".device-button").forEach((e=>e.addEventListener("click",(t=>{var n;n=e.id,i.remove(),a(n)}))))}))}const u=["3.x.x-maintenance"],p=M("version"),h=M("flashButton"),f=M("connectButton"),m=M("vendor"),v=M("type"),b=M("model"),g=M("lblConnTo"),w=M("method"),y=M("device-next");let x=null,T=null,_=null,k=null,L=null,S=null,E=null;function M(e){return document.getElementById(e)}function A(e,t=!0){if("string"==typeof e){document.querySelectorAll(e).forEach((e=>{P(e,"display--none",!t)}))}else"object"==typeof e&&P(e,"display--none",!t)}function P(e,t,n=!0){const a="string"==typeof e?document.querySelector(e):e;n?a.classList.add(t):a.classList.remove(t)}document.addEventListener("DOMContentLoaded",(function(){L=new o.Terminal({cols:80,rows:40});const e=new i.FitAddon;L.loadAddon(e),L.open(M("serial-monitor")),e.fit(),r();let t=!0;for(const e in u){const n=document.createElement("option");n.value=u[e],n.innerHTML=u[e],n.selected=t,p.appendChild(n),t=!1}p.onchange()}),!1),M("device-discover").onclick=async()=>{fetch("http://localhost:9097/mdns").then((e=>function(e){if(!e.ok)throw Promise.reject(new Error("Failed to connect to device"));return e.json()}(e))).catch((async e=>{throw new c.n("Auto-discovery proxy not running","Auto detection of wifi devices cannot be performed without the help of the ExpressLRS auto-discovery proxy","warning")})).then((e=>{if(0===Object.keys(e).length)throw new c.n("No wifi devices detected","Auto deteection failed to find any devices on the network","error");let t="";for(const n of Object.keys(e)){t+=`<tr><td>${n.substring(0,n.indexOf("."))}</td><td>${e[n].address}</td><td><button class="mui-btn mui-btn--small mui-btn--primary device-button" id="${n}">Select</button></td></tr>`}const n=`\n<table class="mui-table">\n  <thead>\n    <tr>\n      <th>Product</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n      ${t}\n  </tbody>\n  </table>\n`;return Promise.all([d({title:"Select Device to Flash",bodyTemplate:n,closeStyle:"circle"}),e])})).then((([e,t])=>{const n=[];let a=0,r="";for(const s of Object.keys(x))for(const o of Object.keys(x[s]))for(const i of Object.keys(x[s][o]))void 0!==t[e].properties.product&&x[s][o][i].product_name===t[e].properties.product&&(n.push({vendor:s,type:o,model:i,product:x[s][o][i].product_name}),r+=`<tr><td style="padding: 0px;">${x[s][o][i].product_name}</td><td style="padding: 0px;"><button class="mui-btn mui-btn--small mui-btn--primary device-button" id="${a}">Select</button></td></tr>`,a++),x[s][o][i].prior_target_name===t[e].properties.target&&(n.push({vendor:s,type:o,model:i,product:x[s][o][i].product_name}),r+=`<tr><td style="padding: 0px;">${x[s][o][i].product_name}</td><td style="padding: 0px;"><button class="mui-btn mui-btn--small mui-btn--primary device-button" id="${a}">Select</button></td></tr>`,a++);const s=`\n<table class="mui-table">\n  <thead>\n    <tr>\n      <th>Device</th>\n      <th>Address</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n      ${r}\n  </tbody>\n  </table>\n`;return Promise.all([n,t[e],d({title:"Select Device Model",bodyTemplate:s,closeStyle:"circle"})])})).then((([e,t,n])=>{E=null,void 0!==n&&(m.value=e[n].vendor,m.onchange(),v.value=e[n].type,v.onchange(),b.value=e[n].model,b.onchange(),y.onclick(),w.value="wifi",w.onchange(),E="http://localhost:9097/"+t.address)})).catch((e=>(0,l.Q)({type:e.type,title:e.title,message:e.message,closeStyle:"circle"})))},p.onchange=async()=>{m.options.length=1,m.disabled=!0,m.value="",v.disabled=!0,v.value="",b.disabled=!0,b.value="",fetch("firmware/"+p.value+"/hardware/targets.json").then((e=>function(e){if(!e.ok)throw new Error(`HTTP ${e.status} - ${e.statusText}`);return e}(e)&&e.json())).then((e=>{x=e;for(const t in e){const n=document.createElement("option");n.value=t,n.innerHTML=void 0===e[t].name?t:e[t].name,m.appendChild(n)}m.disabled=!1,A(".uart",!1),A(".stlink",!1),A(".wifi",!1)}))},M("step-1").onclick=()=>{A("#step-device"),A("#step-options",!1),A("#step-flash",!1),P("#step-1","done",!1),P("#step-1","active"),P("#step-1","editable"),P("#step-2","active",!1),P("#step-2","editable",!1),P("#step-2","done",!1),P("#step-3","active",!1),P("#step-3","editable",!1),P("#step-3","done",!1)},M("step-2").onclick=()=>{"block"===M("step-flash").style.display&&(A("#step-options"),A("#step-flash",!1),P("#step-2","done",!1),P("#step-2","active"),P("#step-2","editable"),P("#step-3","active",!1),P("#step-3","editable",!1),P("#step-3","done",!1))},m.onchange=()=>{M("tx_2400").disabled=!0,M("tx_900").disabled=!0,M("rx_2400").disabled=!0,M("rx_900").disabled=!0;for(const e in x[m.value])null!==M(e)&&(M(e).disabled=!1);v.disabled=!1,v.value="",b.disabled=!0,b.value="",y.disabled=!0},v.onchange=()=>{b.options.length=1;for(const e in x[m.value][v.value]){const t=document.createElement("option");t.value=e,t.innerHTML=x[m.value][v.value][e].product_name,b.appendChild(t)}b.disabled=!1,b.value="",y.disabled=!0},b.onchange=()=>{y.disabled=!1},y.onclick=()=>{A(".tx_2400",!1),A(".rx_2400",!1),A(".tx_900",!1),A(".rx_900",!1),A(".esp8285",!1),A(".esp32",!1),A(".stm32",!1),A(".feature-fan",!1),A(".feature-unlock-higher-power",!1),A(".feature-sbus-uart",!1),A(".feature-buzzer",!1);const e=x[m.value][v.value][b.value].features;e&&e.forEach((e=>A(".feature-"+e))),M("fcclbt").value="FCC",A("."+v.value),A("."+x[m.value][v.value][b.value].platform),M("uart").disabled=!0,M("betaflight").disabled=!0,M("etx").disabled=!0,M("wifi").disabled=!0,M("stlink").disabled=!0,x[m.value][v.value][b.value].upload_methods.forEach((e=>{M(e).disabled=!1})),A("#step-device",!1),P("#step-2","active"),P("#step-2","editable"),P("#step-1","done"),P("#step-1","editable",!1),A("#step-options")},w.onchange=()=>{M("options-next").disabled=!1,"download"===w.value?M("options-next").value="Download":M("options-next").value="Next"};const $=async e=>{const t=x[m.value][v.value][b.value],a="firmware/"+p.value+"/"+M("fcclbt").value+"/"+t.firmware+"/firmware.bin",r={};if(""!==M("uid").value&&(r.uid=M("uid").value.split(",").map((e=>Number(e)))),"stm32"!==t.platform&&(r["wifi-on-interval"]=+M("wifi-on-interval").value,""!==M("wifi-ssid").value&&(r["wifi-ssid"]=M("wifi-ssid").value,r["wifi-password"]=M("wifi-password").value)),"RX"===e?(r["rcvr-uart-baud"]=+M("rcvr-uart-baud").value,r["rcvr-invert-tx"]=M("rcvr-invert-tx").checked,r["lock-on-first-connection"]=M("lock-on-first-connection").checked):(r["tlm-interval"]=+M("tlm-interval").value,r["fan-runtime"]=+M("fan-runtime").value,r["uart-inverted"]=M("uart-inverted").checked,r["unlock-higher-power"]=M("unlock-higher-power").checked),"rx_900"!==v.value&&"tx_900"!==v.value||(r.domain=+M("domain").value),void 0!==t.features&&-1!==t.features.indexOf("buzzer")){const e=Number(M("melody-type").value);r.beeptype=e>2?2:e,r.melody=await Promise.all([n.e(216),n.e(351)]).then(n.bind(n,8351)).then((t=>2===e?t.MelodyParser.parseToArray("A4 20 B4 20|60|0"):3===e?t.MelodyParser.parseToArray("E5 40 E5 40 C5 120 E5 40 G5 22 G4 21|20|0"):4===e?t.MelodyParser.parseToArray(t("melody").value):[]))}return{config:t,firmwareUrl:a,options:r}},C=async()=>{const e=v.value.startsWith("tx_")?"TX":"RX",t=v.value.endsWith("_900")?"sx127x":"sx128x";await $(e).then((({config:a,firmwareUrl:r,options:o})=>{Promise.all([navigator.serial.requestPort().then((e=>{T=e,T.addEventListener("disconnect",(async e=>{T=null,L.clear(),A(h,!1),A(f)})),A(f,!1)})),s.download(e,t,a,r,o).then((e=>{k=e}))]).then((t=>{const s=w.value;let i;i="stm32"===a.platform?Promise.all([n.e(762),n.e(968)]).then(n.bind(n,5968)).then((t=>new t.XmodemFlasher(T,e,s,a,o,r,L))):Promise.all([n.e(216),n.e(762),n.e(883)]).then(n.bind(n,5076)).then((t=>new t.ESPFlasher(T,e,s,a,o,r,L))),i.then((e=>(_=e,e.connect()))).then((e=>{g.innerHTML="Connected to device: "+e,A(h)})).catch((e=>{if(A(h,!1),A(f),!(e instanceof c.P))return e instanceof c.n?(g.innerHTML="Failed to connect to device, restart device and try again",(0,l.Q)({type:"error",title:e.title,message:e.message})):(g.innerHTML="Failed to connect to device, restart device and try again",A(h,!1),A(f),(0,l.Q)({type:"error",title:e.title,message:e.message}));g.innerHTML="Target mismatch, flashing cancelled"}))})).catch((()=>(g.innerHTML="No device selected",A(h,!1),A(f),(0,l.Q)({type:"error",title:"No Device Selected",message:"A serial device must be select to perform flashing"}))))}))},H=async()=>{const e=v.value.startsWith("tx_")?"TX":"RX",t=v.value.endsWith("_900")?"sx127x":"sx128x";return $(e).then((({config:n,firmwareUrl:a,options:r})=>Promise.all([s.download(e,t,n,a,r),{config:n,firmwareUrl:a,options:r}])))},U=async()=>{await Promise.all([n.e(448).then(n.bind(n,3448)).then((e=>new e.STLink(L))),H()]).then((([e,[t,{config:n,firmwareUrl:a,options:r}]])=>e.connect(n,a,r,(e=>{L.clear(),A(h,!1),A(f)})).then((n=>{g.innerHTML="Connected to device: "+n,A(f,!1),A(h),k=t,S=e})).catch((e=>(g.innerHTML="Not connected",A(h,!1),A(f),Promise.reject(e))))))},F=async()=>{function e(e){if(!e.ok)throw Promise.reject(new Error("Failed to connect to device"));return e.json()}const t=v.value.substring(0,2);let n;n=null!==E?fetch(E+"/target").then((t=>e(t))).then((e=>[E,e])):Promise.any([fetch("http://10.0.0.1/target").then((t=>e(t))).then((e=>["http://10.0.0.1",e])),fetch(`http://elrs_${t}/target`).then((t=>e(t))).then((e=>[`http://elrs_${t}`,e])),fetch(`http://elrs_${t}.local/target`).then((t=>e(t))).then((e=>[`http://elrs_${t}`,e]))]),await n.then((([e,t])=>{g.innerHTML="Connected to: "+e,M("product_name").innerHTML="Product name: "+t.product_name,M("target").innerHTML="Target firmware: "+t.target,M("firmware-version").innerHTML="Version: "+t.version,A(h),E=e})).catch((e=>{g.innerHTML="No device found, or error connecting to device",console.log(e)}))};M("options-next").onclick=async()=>{const e=w.value;"download"===e?await q():(A("#step-options",!1),P("#step-3","active"),P("#step-3","editable"),P("#step-2","done"),P("#step-2","editable",!1),A("#step-flash"),A("."+e),f.onclick="wifi"===e?F:"stlink"===e?U:C,await f.onclick())},h.onclick=async()=>{"wifi"===w.value?await B():null!==_?await _.flash(k,M("erase-flash").checked).then((()=>(0,l.Q)({type:"success",title:"Flashing Succeeded",message:"Firmware upload complete"}))).catch((e=>(0,l.Q)({type:"error",title:"Flashing Failed",message:e.message}))):await S.flash(k,M("flash-bootloader").checked).then((()=>{(0,l.Q)({type:"success",title:"Flashing Succeeded",message:"Firmware upload complete"})})).catch((e=>{j(e.message)}))};const q=async()=>{await H().then((([e,{config:t,firmwareUrl:n,options:a}])=>{let r=null;const s=document.createElement("a");s.setAttribute("download","firmware.bin"),s.href=function(){const t=e[e.length-1].data.buffer,n=new Blob([t],{type:"application/octet-stream"});return null!==r&&window.URL.revokeObjectURL(r),r=window.URL.createObjectURL(n),r}(),document.body.appendChild(s),window.requestAnimationFrame((function(){const e=new MouseEvent("click");s.dispatchEvent(e),document.body.removeChild(s)}))}))},B=async()=>{h.disabled=!0,await H().then((([e,{config:t,firmwareUrl:n,options:a}])=>{const r=e[e.length-1].data.buffer,s=new Blob([r],{type:"application/octet-stream"}),o=new FormData;o.append("upload",s,"firmware.bin");const i=new XMLHttpRequest;i.upload.addEventListener("progress",O,!1),i.addEventListener("load",z,!1),i.addEventListener("error",(e=>j(e.target.responseText)),!1),i.addEventListener("abort",I,!1),i.open("POST",E+"/update"),i.setRequestHeader("X-FileSize",s.size),i.send(o)})).catch((e=>{h.disabled=!1}))};function O(e){const t=Math.round(e.loaded/e.total*100);M("progressBar").value=t,M("status").innerHTML=t+"% uploaded... please wait"}function z(e){M("status").innerHTML="",M("progressBar").value=0,h.disabled=!1;const t=JSON.parse(e.target.responseText);if("ok"===t.status){let e=0;const n=setInterval((()=>{e+=2,M("progressBar").value=e,M("status").innerHTML=e+"% flashed... please wait",100===e&&(clearInterval(n),M("status").innerHTML="",M("progressBar").value=0,(0,l.Q)({type:"success",title:"Update Succeeded",message:t.msg}))}),100)}else"mismatch"===t.status?(0,l.Q)({type:"question",title:"Targets Mismatch",message:t.msg,confirmText:"Flash anyway",cancelText:"Cancel"}).then((e=>{const t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(M("status").innerHTML="",M("progressBar").value=0,200===this.status){const e=JSON.parse(this.responseText);(0,l.Q)({type:"info",title:"Force Update",message:e.msg})}else(0,l.Q)({type:"error",title:"Force Update",message:"An error occurred trying to force the update"})},t.open("POST",E+"/forceupdate",!0);const n=new FormData;n.append("action",e),t.send(n)})):(0,l.Q)({type:"error",title:"Update Failed",message:t.msg})}function j(e){M("status").innerHTML="",M("progressBar").value=0,h.disabled=!1,(0,l.Q)({type:"error",title:"Update Failed",message:e})}function I(e){M("status").innerHTML="",M("progressBar").value=0,h.disabled=!1,(0,l.Q)({type:"info",title:"Update Aborted",message:e.target.responseText})}},905:(e,t,n)=>{n.d(t,{P:()=>r,n:()=>a});class a extends Error{constructor(e,t,n="error"){super(t),this.title=e,this.type=n}}class r extends Error{}}},e=>{e.O(0,[216],(()=>{return t=7788,e(e.s=t);var t}));e.O()}]);